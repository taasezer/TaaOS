#!/usr/bin/env python3
"""
TaaOS AI - Natural Language Interface
Talk to your OS like a human
"""

import sys
import json
import requests
from typing import Dict, Optional

class TaaOSAI:
    """Natural language AI interface for TaaOS"""
    
    def __init__(self):
        self.neural_engine = "http://localhost:9999"
        self.ollama_url = "http://localhost:11434/api/generate"
        
        # Natural language command mappings
        self.intent_patterns = {
            'help': ['help', 'yardÄ±m', 'nasÄ±l', 'how', 'what'],
            'generate': ['oluÅŸtur', 'yap', 'create', 'generate', 'make', 'build'],
            'review': ['incele', 'kontrol', 'review', 'check', 'analyze'],
            'test': ['test', 'deneme', 'testing'],
            'explain': ['aÃ§Ä±kla', 'explain', 'nedir', 'what is'],
            'optimize': ['optimize', 'iyileÅŸtir', 'improve', 'hÄ±zlandÄ±r'],
            'fix': ['dÃ¼zelt', 'fix', 'repair', 'solve'],
            'translate': ['Ã§evir', 'translate', 'convert'],
            'document': ['dokÃ¼mante', 'document', 'aÃ§Ä±klama yaz']
        }
    
    def show_help(self, command: Optional[str] = None):
        """Show detailed help"""
        
        help_text = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    TaaOS AI Assistant                            â•‘
â•‘              Yapay Zeka Destekli Ä°ÅŸletim Sistemi                 â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ—£ï¸  DOÄAL DÄ°L KULLANIMI:
   KomutlarÄ± TÃ¼rkÃ§e veya Ä°ngilizce, doÄŸal dil ile yazabilirsiniz!
   
   Ã–rnekler:
   â€¢ taaos "bir REST API oluÅŸtur"
   â€¢ taaos "bu kodu incele: myfile.py"
   â€¢ taaos "sistemdeki hatalarÄ± analiz et"
   â€¢ taaos "Python ile web scraper yap"

ğŸ“‹ KOMUTLAR:

1ï¸âƒ£  KOD OLUÅTURMA
   taaos generate <aÃ§Ä±klama> [dil]
   taaos "bir <aÃ§Ä±klama> yap"
   
   Ã–rnekler:
   â€¢ taaos generate "authentication sistemi" python
   â€¢ taaos "FastAPI ile REST API yap"
   â€¢ taaos "React ile login sayfasÄ± oluÅŸtur"
   
   Ne yapar: DoÄŸal dilden kod Ã¼retir

2ï¸âƒ£  KOD Ä°NCELEME
   taaos review <dosya> [dil]
   taaos "ÅŸu kodu incele: <dosya>"
   
   Ã–rnekler:
   â€¢ taaos review app.py
   â€¢ taaos "main.rs dosyasÄ±nÄ± kontrol et"
   
   Ne yapar: GÃ¼venlik, performans, best practice kontrolÃ¼

3ï¸âƒ£  TEST OLUÅTURMA
   taaos test <dosya> [dil]
   taaos "ÅŸunun testini yaz: <dosya>"
   
   Ã–rnekler:
   â€¢ taaos test utils.py
   â€¢ taaos "api.js iÃ§in test yaz"
   
   Ne yapar: Otomatik unit test oluÅŸturur

4ï¸âƒ£  HATA AÃ‡IKLAMA
   taaos explain <hata>
   taaos "ÅŸu hatayÄ± aÃ§Ä±kla: <hata>"
   
   Ã–rnekler:
   â€¢ taaos explain "NameError: name 'x' is not defined"
   â€¢ taaos "bu ne demek: TypeError"
   
   Ne yapar: HatayÄ± aÃ§Ä±klar ve Ã§Ã¶zÃ¼m Ã¶nerir

5ï¸âƒ£  SORGU OPTÄ°MÄ°ZASYONU
   taaos optimize-query <sorgu> [veritabanÄ±]
   taaos "ÅŸu sorguyu optimize et: <sorgu>"
   
   Ã–rnekler:
   â€¢ taaos optimize-query "SELECT * FROM users" postgresql
   â€¢ taaos "bu SQL'i hÄ±zlandÄ±r: SELECT..."
   
   Ne yapar: VeritabanÄ± sorgularÄ±nÄ± optimize eder

6ï¸âƒ£  DOKÃœMANTASYON
   taaos document <dosya> [dil]
   taaos "ÅŸunun dokÃ¼mantasyonunu yaz: <dosya>"
   
   Ã–rnekler:
   â€¢ taaos document functions.py
   â€¢ taaos "utils.js iÃ§in aÃ§Ä±klama yaz"
   
   Ne yapar: Kod iÃ§in dokÃ¼mantasyon oluÅŸturur

7ï¸âƒ£  KOD Ã‡EVÄ°RÄ°SÄ°
   taaos translate <dosya> <kaynak_dil> <hedef_dil>
   taaos "ÅŸunu <hedef_dil>'e Ã§evir: <dosya>"
   
   Ã–rnekler:
   â€¢ taaos translate script.py python javascript
   â€¢ taaos "bu Python kodunu Rust'a Ã§evir: app.py"
   
   Ne yapar: Kodu baÅŸka dile Ã§evirir

8ï¸âƒ£  LOG ANALÄ°ZÄ°
   taaos analyze-logs <log_dosyasÄ±>
   taaos "ÅŸu loglarÄ± analiz et: <dosya>"
   
   Ã–rnekler:
   â€¢ taaos analyze-logs /var/log/syslog
   â€¢ taaos "sistem loglarÄ±nÄ± incele"
   
   Ne yapar: Log dosyalarÄ±nÄ± analiz eder

9ï¸âƒ£  DUYGU ANALÄ°ZÄ°
   taaos sentiment <metin>
   taaos "ÅŸunun duygusunu analiz et: <metin>"
   
   Ã–rnekler:
   â€¢ taaos sentiment "Bu harika bir Ã¼rÃ¼n!"
   â€¢ taaos "bu yorumun tonu nedir: ..."
   
   Ne yapar: Metin duygu analizi yapar

ğŸ”Ÿ  MÄ°MARÄ° Ã–NERÄ°SÄ°
   taaos architecture <gereksinimler>
   taaos "ÅŸunun iÃ§in mimari Ã¶ner: <gereksinimler>"
   
   Ã–rnekler:
   â€¢ taaos architecture "e-ticaret platformu"
   â€¢ taaos "blog sitesi iÃ§in tech stack Ã¶ner"
   
   Ne yapar: Sistem mimarisi Ã¶nerir

ğŸ’¡ Ä°PUÃ‡LARI:
   â€¢ KomutlarÄ± TÃ¼rkÃ§e veya Ä°ngilizce yazabilirsiniz
   â€¢ DoÄŸal dil kullanabilirsiniz: "bir web scraper yap"
   â€¢ -h veya --help ile detaylÄ± yardÄ±m alÄ±n
   â€¢ TÃ¼m AI Ã¶zellikleri yerel olarak Ã§alÄ±ÅŸÄ±r (gizlilik)

ğŸ“š Ã–RNEKLER:
   taaos "Python ile web scraper oluÅŸtur"
   taaos "bu kodu incele ve optimize et: app.py"
   taaos "sistemdeki son hatalarÄ± analiz et"
   taaos "FastAPI ile authentication API'si yap"

ğŸŒ DAHA FAZLA:
   DokÃ¼mantasyon: /usr/share/doc/taaos/ai-guide.md
   Ã–rnekler: /usr/share/doc/taaos/ai-examples.md
   
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
        print(help_text)
    
    def parse_natural_language(self, text: str) -> Dict:
        """Parse natural language command"""
        text_lower = text.lower()
        
        # Detect intent
        intent = 'general'
        for intent_type, patterns in self.intent_patterns.items():
            if any(pattern in text_lower for pattern in patterns):
                intent = intent_type
                break
        
        return {
            'intent': intent,
            'text': text,
            'language': 'tr' if any(c in text for c in 'Ã§ÄŸÄ±Ã¶ÅŸÃ¼') else 'en'
        }
    
    def execute_natural_command(self, text: str):
        """Execute natural language command"""
        parsed = self.parse_natural_language(text)
        
        # Send to Neural Engine for processing
        try:
            response = requests.post(
                self.neural_engine,
                json={
                    'type': 'voice_command',
                    'command': text
                },
                timeout=30
            )
            
            if response.status_code == 200:
                result = response.json()
                print("\n" + "="*60)
                print("ğŸ¤– TaaOS AI:")
                print("="*60)
                print(result.get('response', 'No response'))
                
                # Execute command if suggested
                if result.get('execute') and result.get('command'):
                    print("\n" + "-"*60)
                    print("ğŸ’» Ã–nerilen Komut:")
                    print("-"*60)
                    print(result['command'])
                    
                    confirm = input("\nBu komutu Ã§alÄ±ÅŸtÄ±rmak ister misiniz? (e/h): ")
                    if confirm.lower() in ['e', 'y', 'yes', 'evet']:
                        import subprocess
                        subprocess.run(result['command'], shell=True)
            else:
                print(f"âŒ Hata: Neural Engine'e baÄŸlanÄ±lamadÄ±")
        
        except Exception as e:
            print(f"âŒ Hata: {e}")
            print("\nğŸ’¡ Ä°pucu: Neural Engine'in Ã§alÄ±ÅŸtÄ±ÄŸÄ±ndan emin olun:")
            print("   sudo systemctl status taaos-neural-engine")

def main():
    ai = TaaOSAI()
    
    # No arguments or help
    if len(sys.argv) == 1 or sys.argv[1] in ['-h', '--help', 'help', 'yardÄ±m']:
        ai.show_help()
        return
    
    # Join all arguments as natural language
    command = ' '.join(sys.argv[1:])
    
    # Execute
    ai.execute_natural_command(command)

if __name__ == '__main__':
    main()
