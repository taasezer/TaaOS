#!/usr/bin/env python3
"""
TaaOS Log Viewer
Simple GUI for viewing system logs
"""

import sys
import subprocess
from PyQt5.QtWidgets import *
from PyQt5.QtCore import QTimer, Qt
from PyQt5.QtGui import QFont

COLORS = {'primary': '#D40000', 'background': '#0A0A0A', 'surface': '#1A1A1A', 'text': '#F5F5F0'}

class LogViewer(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("TaaOS Log Viewer")
        self.setGeometry(100, 100, 1000, 600)
        
        central = QWidget()
        self.setCentralWidget(central)
        layout = QVBoxLayout(central)
        
        # Log type selector
        toolbar = QHBoxLayout()
        
        self.log_combo = QComboBox()
        self.log_combo.addItems([
            "System (journalctl)",
            "TaaOS Guardian",
            "TaaPac",
            "Kernel (dmesg)",
            "X.org",
            "Boot log",
        ])
        self.log_combo.currentTextChanged.connect(self.load_log)
        
        refresh_btn = QPushButton("üîÑ Refresh")
        refresh_btn.clicked.connect(self.load_log)
        
        clear_btn = QPushButton("üóëÔ∏è Clear")
        clear_btn.clicked.connect(self.clear_log)
        
        toolbar.addWidget(QLabel("Log Type:"))
        toolbar.addWidget(self.log_combo)
        toolbar.addWidget(refresh_btn)
        toolbar.addWidget(clear_btn)
        toolbar.addStretch()
        
        layout.addLayout(toolbar)
        
        # Log display
        self.log_text = QTextEdit()
        self.log_text.setReadOnly(True)
        self.log_text.setFont(QFont("JetBrains Mono", 10))
        self.log_text.setStyleSheet(f"""
            QTextEdit {{
                background-color: {COLORS['background']};
                color: {COLORS['text']};
                border: 1px solid {COLORS['surface']};
            }}
        """)
        
        layout.addWidget(self.log_text)
        
        # Auto-refresh
        self.timer = QTimer()
        self.timer.timeout.connect(self.load_log)
        self.timer.start(5000)  # Refresh every 5 seconds
        
        self.apply_theme()
        self.load_log()
    
    def load_log(self):
        log_type = self.log_combo.currentText()
        
        try:
            if "System" in log_type:
                output = subprocess.check_output(['journalctl', '-n', '100', '--no-pager'], 
                                                text=True, stderr=subprocess.STDOUT)
            elif "Guardian" in log_type:
                output = subprocess.check_output(['tail', '-n', '100', '/var/log/taaos-guardian.log'], 
                                                text=True, stderr=subprocess.STDOUT)
            elif "TaaPac" in log_type:
                output = subprocess.check_output(['tail', '-n', '100', '/var/log/taapac.log'], 
                                                text=True, stderr=subprocess.STDOUT)
            elif "Kernel" in log_type:
                output = subprocess.check_output(['dmesg', '--color=never'], 
                                                text=True, stderr=subprocess.STDOUT)
            elif "X.org" in log_type:
                output = subprocess.check_output(['tail', '-n', '100', '/var/log/Xorg.0.log'], 
                                                text=True, stderr=subprocess.STDOUT)
            elif "Boot" in log_type:
                output = subprocess.check_output(['journalctl', '-b', '--no-pager'], 
                                                text=True, stderr=subprocess.STDOUT)
            else:
                output = "Unknown log type"
            
            self.log_text.setPlainText(output)
            self.log_text.moveCursor(self.log_text.textCursor().End)
            
        except FileNotFoundError:
            self.log_text.setPlainText(f"Log file not found for: {log_type}")
        except subprocess.CalledProcessError as e:
            self.log_text.setPlainText(f"Error loading log: {str(e)}")
    
    def clear_log(self):
        self.log_text.clear()
    
    def apply_theme(self):
        self.setStyleSheet(f"""
            QMainWindow {{ background-color: {COLORS['surface']}; }}
            QWidget {{ background-color: {COLORS['surface']}; color: {COLORS['text']}; }}
            QPushButton {{
                background-color: {COLORS['primary']};
                color: {COLORS['text']};
                border: none;
                padding: 8px 15px;
                border-radius: 5px;
            }}
            QPushButton:hover {{ background-color: #FF3333; }}
            QComboBox {{
                background-color: {COLORS['background']};
                color: {COLORS['text']};
                border: 1px solid {COLORS['primary']};
                padding: 5px;
                border-radius: 3px;
            }}
        """)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = LogViewer()
    window.show()
    sys.exit(app.exec_())
